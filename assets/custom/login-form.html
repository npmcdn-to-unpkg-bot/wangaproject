<link rel="import" href="../components/polymer/polymer.html">
<link rel="import" href="../components/iron-ajax/iron-ajax.html">
<link rel="import" href="../components/paper-input/paper-input.html">
<link rel="import" href="../components/paper-button/paper-button.html">

<dom-module id="login-form">

   
        <style>
            #loginBut {
                background: #4285f4;
                color: #fff;
                padding: 5px 10px;
                margin-right: 15px;;
            }
            .error {
                color:red;
            }
        </style>

     <template>
         <iron-ajax id="LoginAjax"
                   method="POST"
                   contentType="application/json"
                   url="/conta/login/"
                   
                   on-response="Lresponse"
                   
                   handleAs="json"></iron-ajax>
        <template is="dom-repeat" items="errors">
           
            <span class="error">{{errors.0.failure}}</span>
            <p>Hool</p>
            <br>
        </template>

        <div id="output"></div>
        <paper-input id="inputForValidation" placeholder="Enter Your Email" auto-validate pattern="^(.)+@[a-z A-Z _]+?\.[a-zA-Z]{2,3}$" name="username" type="email" floatingLabel value="{{username::input}}" error-message="Enter valide email!"></paper-input>
        <br>
        <paper-input label="Password" name="password" type="password" floatingLabel value="{{password::input}}"></paper-input>
        <br>
        <paper-button label="Login" raised  type="submit" id="loginBut" on-click="submit">Login</paper-button> 
        <paper-button label="Register" raised id="loginBut" on-click="register">Register</paper-button> -->
       
    </template>

</dom-module>

<script>
        Polymer({
            is:'login-form',
            getCSRFCookie: function() {
                b = document.cookie.match('(^|;)\\s*csrftoken\\s*=\\s*([^;]+)');
                return b ? b.pop() : '';
            },
            register:function(){
                window.location.href = "/conta/register";
            },
            submit:function(){
                
                if (this.password != "" && this.username != "") {
                        var userdata = JSON.stringify({ username:this.username , password:this.password});
                        this.$.LoginAjax.body = userdata;
                        console.log(userdata);
                        console.log(this.getCSRFCookie());
                        this.ajaxParams={username: this.username, password: this.password};
                        this.$.LoginAjax.headers={"X-CSRFToken":this.getCSRFCookie()};
                        this.$.LoginAjax.generateRequest();
                }else{
                        console.log("Must include 'email' and 'password'.")
                }
             },
             
            Lresponse: function(r){
                
                resp = r.detail.response;
                
                if(resp.log == true){
                    window.location.href = "/conta/profile";
                }else{
                    console.log("Login Failed");
                    this.errors = resp.errors[0];
                    console.log(resp.errors[0]['failure']);
                }
            },

            properties:{
                password:{
                    type:String,
                    value:"",
                    notify:true
                },
                
                username:{
                    type:String,
                    value:"",
                    notify:true
                },
                errors:{
                    type:Object
                }
            }
            
        });
</script>